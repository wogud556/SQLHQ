## 11 Shared pool

### 1 딕셔너리 캐시란
- Shared pool 은 크게 딕셔너리 캐시(Directory Cache)와 라이브러리 캐시(library cache)로 나뉨
- 딕셔너리 캐시란 말 그대로 오라클 딕셔너리 정보를 저장해 두는 캐시 영역으로 Row 단위로 읽고 쓰기 때문에 로우 캐시라고도 부름
- 테이블 인덱스 같은 오브젝트는 물론 테이블스페이스, 데이터파일, 세그먼트, 익스텐트, 사용자, 제약, Sequence, DB link 에 관한 정보들을 캐싱함

#### 딕셔너리 캐시 예시
- 사용자가 Sequence 객체를 하나 만들면 오라클 딕셔너리에 저장
- 로우 캐시를 거쳐 읽고 쓰기가 이루어짐
- 사용자가 Sequence로부터 새로운 값을 인출하기 위해 nextval 을 호출할 때마다 로우 캐시를 통해 update가 이루어짐

#### sequence Cache 옵션
- 잦은 채번은 로우 캐시에 경합을 발생시키게 됨
- 이를 해소하기 위해 필수적으로 Cache 옵션을 사용해야 함
- Cache 크기가 10이면 Noeache 일 때보다 로우 캐시를 갱신하는 횟수가 1/10으로 줌
- 동시에 채번이 많아 발생하는 Sequence 일수록 cache 사이즈를 크게 설정하는 것은 매우 중요한 튜닝 요소 중 하나이며, 기본 설정값은 20
- 딕셔너리 캐시의 활동성에 대한 통계를 조회해볼 수 있는 뷰가 v$rowcache인데, 여기서 히트율를 조사했을 때 수치가 낮게나오면 Shared pool사이즈를 늘리는 것을 고려해볼 필요가 있음
- v$rowcache에서 TYPE = ‘PARENT’인 엔트리와 v$latch_children 에서 이름이 row cache objects 인 래치 개수를 조회해보면, 항상 값이 일치하는 것을 알 수 있음
- 즉 로우 캐시에 관리되는 엔트리 각각에 대해 하나의 래치가 할당돼 있음을 짐작할 수 있음

### 2 라이브러리 캐시
- shared Pool 을 구성하는 두번째 캐시 영역은 라이브러리 캐시
- 이것은 지금까지 설명한 캐시 영역과는 조금 다른 역할을 한다
- DB 버퍼캐시, Redo 로그버퍼캐시, 딕셔너리 캐시 등은 데이터의 입출력을 빠르게 하기 위한 캐시 영역인 반면 라이브러리 캐시는 사용자가 던진 SQL과 그 실행 계획을 저장해 두는 캐시영역임


#### 실행계확
- 사용자가 SQL 이라는 명령어를 통해 결과집합을 요청하면 이를 최적으로 수행하기 위한 처리 루틴이 필요한데 이를 실행계획이라고함

#### 하드파싱
- 쿼리 구문을 분석해서 문법 오류 및 실행 권한 등을 체크하고 최적화 과정을 거쳐 실행계획을 만들고 ,SQL 실행엔진이 이해할 수 있는 형태로 포매팅하는것
- 최적화는 하드 파싱을 무겁게 만드는 가장 결정적 요인, 같은 SQL을 처리하려고 이런 무거운 작업을 반복 수행하는 것은 매우 비효율적
- 같은 SQL에 대한 반복적인 하드파싱을 최소화하기 위한 새로운 캐시 공간을 두게 되고 그것이 바로 라이브러리 캐시 영역
- 당연히 라이브러리 캐시 최적화 원리는 캐싱된 SQL 과 그 실행계획의 재사용성을 높이는 데에 있음

## 2 트랜잭션과 Lock
- Lock 이란 각 데이터베이스의 특징을 결정짓는 핵심적인 원리
- 따라서 사용하는 데이터베이스만의 독특한 Lock 매커니즘을 이해하지 못한다면 고품질 = 고성능의 애플리케이션을 구축하기 어려움
- 트랜잭션과 동시성 제어에 대한 개념 또한 데이터베이스 프로그래머의 필수 과목
- 본 장은 성능을 논하기 앞서 기본적인 트랜잭션 개념을 상기시키고, 개발자 및 설계자가 반드시 알아야 할 동시성 제어 기법들을 설명
- 그와 함께 일관성과 동시성을 같이 높이는 방안들을 제시
- 개발자-DBA가 반드시 알아야 할 오라클만의 독특한 Lock 매커니즘에 대해 비교적 자세히 설명

